var I18n=I18n||{};I18n.defaultLocale="en",I18n.fallbacks=!1,I18n.defaultSeparator=".",I18n.locale=null,I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,I18n.isValidNode=function(obj,node,undefined){return null!==obj[node]&&obj[node]!==undefined},I18n.lookup=function(scope,options){var currentScope,options=options||{},lookupInitialScope=scope,translations=this.prepareOptions(I18n.translations),messages=translations[options.locale||I18n.currentLocale()],options=this.prepareOptions(options);if(messages){for("object"==typeof scope&&(scope=scope.join(this.defaultSeparator)),options.scope&&(scope=options.scope.toString()+this.defaultSeparator+scope),scope=scope.split(this.defaultSeparator);scope.length>0;)if(currentScope=scope.shift(),messages=messages[currentScope],!messages){I18n.fallbacks&&!options.fallback&&(messages=I18n.lookup(lookupInitialScope,this.prepareOptions({locale:I18n.defaultLocale,fallback:!0},options)));break}return!messages&&this.isValidNode(options,"defaultValue")&&(messages=options.defaultValue),messages}},I18n.prepareOptions=function(){for(var opts,options={},count=arguments.length,i=0;count>i;i++)if(opts=arguments[i])for(var key in opts)this.isValidNode(options,key)||(options[key]=opts[key]);return options},I18n.interpolate=function(message,options){options=this.prepareOptions(options);var placeholder,value,name,matches=message.match(this.PLACEHOLDER);if(!matches)return message;for(var i=0;placeholder=matches[i];i++)name=placeholder.replace(this.PLACEHOLDER,"$1"),value=options[name],this.isValidNode(options,name)||(value="[missing "+placeholder+" value]"),regex=new RegExp(placeholder.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),message=message.replace(regex,value);return message},I18n.translate=function(scope,options){options=this.prepareOptions(options);var translation=this.lookup(scope,options);try{return"object"==typeof translation?"number"==typeof options.count?this.pluralize(options.count,scope,options):translation:this.interpolate(translation,options)}catch(err){return this.missingTranslation(scope)}},I18n.localize=function(scope,value){switch(scope){case"currency":return this.toCurrency(value);case"number":return scope=this.lookup("number.format"),this.toNumber(value,scope);case"percentage":return this.toPercentage(value);default:return scope.match(/^(date|time)/)?this.toTime(scope,value):value.toString()}},I18n.parseDate=function(date){var matches,convertedDate;if("object"==typeof date)return date;if(matches=date.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/)){for(var i=1;6>=i;i++)matches[i]=parseInt(matches[i],10)||0;matches[2]-=1,convertedDate=matches[7]?new Date(Date.UTC(matches[1],matches[2],matches[3],matches[4],matches[5],matches[6])):new Date(matches[1],matches[2],matches[3],matches[4],matches[5],matches[6])}else"number"==typeof date?(convertedDate=new Date,convertedDate.setTime(date)):date.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)?(convertedDate=new Date,convertedDate.setTime(Date.parse(date))):(convertedDate=new Date,convertedDate.setTime(Date.parse(date)));return convertedDate},I18n.toTime=function(scope,d){var date=this.parseDate(d),format=this.lookup(scope);return date.toString().match(/invalid/i)?date.toString():format?this.strftime(date,format):date.toString()},I18n.strftime=function(date,format){var options=this.lookup("date");if(!options)return date.toString();options.meridian=options.meridian||["AM","PM"];var weekDay=date.getDay(),day=date.getDate(),year=date.getFullYear(),month=date.getMonth()+1,hour=date.getHours(),hour12=hour,meridian=hour>11?1:0,secs=date.getSeconds(),mins=date.getMinutes(),offset=date.getTimezoneOffset(),absOffsetHours=Math.floor(Math.abs(offset/60)),absOffsetMinutes=Math.abs(offset)-60*absOffsetHours,timezoneoffset=(offset>0?"-":"+")+(absOffsetHours.toString().length<2?"0"+absOffsetHours:absOffsetHours)+(absOffsetMinutes.toString().length<2?"0"+absOffsetMinutes:absOffsetMinutes);hour12>12?hour12-=12:0===hour12&&(hour12=12);var padding=function(n){var s="0"+n.toString();return s.substr(s.length-2)},f=format;return f=f.replace("%a",options.abbr_day_names[weekDay]),f=f.replace("%A",options.day_names[weekDay]),f=f.replace("%b",options.abbr_month_names[month]),f=f.replace("%B",options.month_names[month]),f=f.replace("%d",padding(day)),f=f.replace("%e",day),f=f.replace("%-d",day),f=f.replace("%H",padding(hour)),f=f.replace("%-H",hour),f=f.replace("%I",padding(hour12)),f=f.replace("%-I",hour12),f=f.replace("%m",padding(month)),f=f.replace("%-m",month),f=f.replace("%M",padding(mins)),f=f.replace("%-M",mins),f=f.replace("%p",options.meridian[meridian]),f=f.replace("%S",padding(secs)),f=f.replace("%-S",secs),f=f.replace("%w",weekDay),f=f.replace("%y",padding(year)),f=f.replace("%-y",padding(year).replace(/^0+/,"")),f=f.replace("%Y",year),f=f.replace("%z",timezoneoffset)},I18n.toNumber=function(number,options){options=this.prepareOptions(options,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var precision,formattedNumber,negative=0>number,string=Math.abs(number).toFixed(options.precision).toString(),parts=string.split("."),buffer=[];for(number=parts[0],precision=parts[1];number.length>0;)buffer.unshift(number.substr(Math.max(0,number.length-3),3)),number=number.substr(0,number.length-3);if(formattedNumber=buffer.join(options.delimiter),options.precision>0&&(formattedNumber+=options.separator+parts[1]),negative&&(formattedNumber="-"+formattedNumber),options.strip_insignificant_zeros){var regex={separator:new RegExp(options.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};formattedNumber=formattedNumber.replace(regex.zeros,"").replace(regex.separator,"")}return formattedNumber},I18n.toCurrency=function(number,options){return options=this.prepareOptions(options,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),number=this.toNumber(number,options),number=options.format.replace("%u",options.unit).replace("%n",number)},I18n.toHumanSize=function(number,options){for(var unit,precision,kb=1024,size=number,iterations=0;size>=kb&&4>iterations;)size/=kb,iterations+=1;return 0===iterations?(unit=this.t("number.human.storage_units.units.byte",{count:size}),precision=0):(unit=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][iterations]),precision=size-Math.floor(size)===0?0:1),options=this.prepareOptions(options,{precision:precision,format:"%n%u",delimiter:""}),number=this.toNumber(size,options),number=options.format.replace("%u",unit).replace("%n",number)},I18n.toPercentage=function(number,options){return options=this.prepareOptions(options,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),number=this.toNumber(number,options),number+"%"},I18n.pluralize=function(count,scope,options){var translation;try{translation=this.lookup(scope,options)}catch(error){}if(!translation)return this.missingTranslation(scope);var message;switch(options=this.prepareOptions(options),options.count=count.toString(),Math.abs(count)){case 0:message=this.isValidNode(translation,"zero")?translation.zero:this.isValidNode(translation,"none")?translation.none:this.isValidNode(translation,"other")?translation.other:this.missingTranslation(scope,"zero");break;case 1:message=this.isValidNode(translation,"one")?translation.one:this.missingTranslation(scope,"one");break;default:message=this.isValidNode(translation,"other")?translation.other:this.missingTranslation(scope,"other")}return this.interpolate(message,options)},I18n.missingTranslation=function(){for(var message='[missing "'+this.currentLocale(),count=arguments.length,i=0;count>i;i++)message+="."+arguments[i];return message+='" translation]'},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize;